<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Get to 999 - Web Game</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Bootstrap core CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Core theme CSS (includes overrides)-->
        <link href="css/styles.css" rel="stylesheet" />
        <!-- Variant code insert link -->
        <link rel="stylesheet" href="css/variants.css">
        <style>
            .game-wrapper {
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 40px 20px;
            }
            .game-container-outer {
                background: rgba(255, 255, 255, 0.95);
                border-radius: 12px;
                padding: 24px;
                max-width: 420px;
                width: 100%;
                box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            }
            .heading { 
                display: flex; 
                justify-content: space-between; 
                align-items: center; 
                margin: 0 0 12px; 
            }
            .game-title { 
                font-size: 36px; 
                color: #000; 
                margin: 0; 
                font-weight: bold;
            }
            .score-container {
                background: #bbada0;
                color: #fff;
                padding: 6px 14px;
                border-radius: 8px;
                font-weight: 700;
                min-width: 68px;
                text-align: center;
            }
            .game-intro { 
                color: #000; 
                margin: 0 0 12px; 
                font-size: 14px;
            }
            .game-container {
                position: relative;
                width: 340px;
                height: 340px;
                margin: 0 auto 16px;
                background: #bbada0;
                border-radius: 6px;
                padding: 10px;
                box-sizing: border-box;
            }
            .grid-container, .tile-container { 
                position: absolute; 
                top: 10px; 
                left: 10px; 
                right: 10px; 
                bottom: 10px; 
            }
            .grid-row { display: flex; }
            .grid-cell {
                width: 75px;
                height: 75px;
                margin: 5px;
                background: rgba(238, 228, 218, 0.35);
                border-radius: 4px;
            }
            .tile {
                position: absolute;
                width: 75px;
                height: 75px;
                border-radius: 4px;
                display: flex;
                justify-content: center;
                align-items: center;
                font-weight: 700;
                font-size: 28px;
                transition: transform 0.1s ease-in-out;
            }
            .tile-inner { 
                width: 100%; 
                height: 100%; 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                border-radius: 4px; 
            }
            .game-message {
                display: none;
                position: absolute;
                top: 0; 
                left: 0; 
                right: 0; 
                bottom: 0;
                background: rgba(238,228,218,0.73);
                border-radius: 6px;
                align-items: center;
                justify-content: center;
                flex-direction: column;
                text-align: center;
                color: #776e65;
                font-size: 32px;
                font-weight: 700;
                z-index: 100;
            }
            .game-message.show { display: flex; }
            .retry-button {
                display: inline-block;
                margin-top: 10px;
                padding: 8px 14px;
                background: #8f7a66;
                color: #f9f6f2;
                border-radius: 6px;
                cursor: pointer;
                text-decoration: none;
            }
            .game-explanation { 
                color: #000; 
                font-size: 14px; 
                margin-bottom: 0;
            }
        </style>
    </head>
    <body>
        <!-- Responsive navbar-->
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="container">
                    <a class="navbar-brand" href="index.html">Ryan Bright</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarWebgame" aria-controls="navbarWebgame" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarWebgame">
                        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                            <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                            <li class="nav-item"><a class="nav-link" href="Resume.html">Resume</a></li>
                            <li class="nav-item"><a class="nav-link" href="ScratchPage.html">Game Reviews</a></li>
                            <li class="nav-item"><a class="nav-link" href="Webgame.html">Webgame</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
        
        <!-- Header -->
        <header class="py-4 bg-image-full custom-bg-cover" style="min-height: 12rem; background-image: linear-gradient(rgba(0,0,0,0.55), rgba(0,0,0,0.55)), url('https://source.unsplash.com/1600x900/?game,abstract')">
            <div class="text-center my-5">
                <h1 class="text-white fs-4 fw-bolder">Get to 999</h1>
                <p class="text-white mb-0">A Number Merging Game</p>
            </div>
        </header>

        <!-- Game Section -->
        <section class="py-5">
            <div class="container">
                <div class="game-wrapper">
                    <div class="game-container-outer">
                        <div class="heading">
                            <h1 class="game-title">Get to 999</h1>
                            <div class="score-container" id="score">0</div>
                        </div>
                        <p class="game-intro">Join the numbers and get to the <strong>999 tile!</strong> 1000 blocks cannot combine with anything.</p>

                        <div class="game-container">
                            <div class="game-message" id="game-message">
                                <p id="game-message-text"></p>
                                <div class="lower">
                                    <a class="retry-button" id="retry">Try again</a>
                                </div>
                            </div>

                            <div class="grid-container">
                                <div class="grid-row">
                                    <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
                                </div>
                                <div class="grid-row">
                                    <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
                                </div>
                                <div class="grid-row">
                                    <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
                                </div>
                                <div class="grid-row">
                                    <div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div>
                                </div>
                            </div>

                            <div class="tile-container" id="tile-container"></div>
                        </div>

                        <p class="game-explanation">
                            <strong>How to play:</strong> Use your <strong>arrow keys</strong> to move the tiles. When any two tiles touch (except 1000 blocks), they <strong>merge into one</strong> with a random value between their sum+5 and 1000. New tiles spawn with random values (2-100). Reach a 999 tile to win!
                        </p>
                        <div style="text-align: center; margin-top: 16px;">
                            <button class="retry-button" id="reset-button">Reset Game</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer-->
        <footer class="py-5 bg-dark">
            <div class="container"><p class="m-0 text-center text-white">Copyright &copy; Gamesite 2025</p></div>
        </footer>

        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>

        <!-- Game Logic -->
        <script>
            const size = 4;
            let grid, score;
            const tileContainer = document.getElementById('tile-container');
            const scoreEl = document.getElementById('score');
            const msg = document.getElementById('game-message');
            const msgText = document.getElementById('game-message-text');
            const retryBtn = document.getElementById('retry');

            function emptyGrid(){
                return Array.from({length:size}, ()=>Array(size).fill(0));
            }

            function spawn(){
                const empties=[];
                for(let r=0;r<size;r++) for(let c=0;c<size;c++) if(!grid[r][c]) empties.push([r,c]);
                if(!empties.length) return;
                const [r,c]=empties[Math.floor(Math.random()*empties.length)];
                // Random starting value between 2 and 100
                grid[r][c] = Math.floor(Math.random() * 99) + 2;
            }

            function tileColor(val){
                const clamped = Math.max(1, Math.min(1000, val));
                const hue = 120 - (clamped/1000)*120;
                return `hsl(${hue}, 70%, 55%)`;
            }

            function tileTextColor(val){
                return val > 64 ? '#f9f6f2' : '#776e65';
            }

            function draw(){
                tileContainer.innerHTML='';
                for(let r=0;r<size;r++){
                    for(let c=0;c<size;c++){
                        const val = grid[r][c];
                        if(!val) continue;
                        const tile=document.createElement('div');
                        tile.className='tile';
                        tile.style.transform=`translate(${c*85}px, ${r*85}px)`;
                        tile.style.background = tileColor(val);
                        tile.style.color = tileTextColor(val);
                        const inner=document.createElement('div');
                        inner.className='tile-inner';
                        inner.textContent=val;
                        tile.appendChild(inner);
                        tileContainer.appendChild(tile);
                    }
                }
                scoreEl.textContent = score;
            }

            function move(dir){
                const traverseRows = dir==='left' || dir==='right';
                const lines = [];
                if(traverseRows){
                    for(let r=0;r<size;r++){ lines.push(grid[r].slice()); }
                } else {
                    for(let c=0;c<size;c++){
                        const col=[]; for(let r=0;r<size;r++) col.push(grid[r][c]);
                        lines.push(col);
                    }
                }
                const resultLines = lines.map(line=>compress(line, dir==='right' || dir==='down'));
                if(traverseRows){
                    for(let r=0;r<size;r++) grid[r]=resultLines[r];
                } else {
                    for(let c=0;c<size;c++) for(let r=0;r<size;r++) grid[r][c]=resultLines[c][r];
                }
                const moved = resultLines.some((line,idx)=>line.join(',')!==lines[idx].join(','));
                if(moved){ spawn(); draw(); checkState(); }
            }

            function compress(line, reverse){
                const arr = reverse ? line.slice().reverse() : line.slice();
                const filtered = arr.filter(v=>v!==0);
                for(let i=0;i<filtered.length-1;i++){
                    if(filtered[i]===1000 || filtered[i+1]===1000){
                        i++;
                        continue;
                    }
                    const baseSum = filtered[i] + filtered[i+1];
                    const minVal = Math.min(1000, baseSum + 5);
                    const newVal = Math.max(minVal, Math.floor(Math.random()* (1000 - minVal + 1)) + minVal);
                    filtered[i]=newVal;
                    score+=filtered[i];
                    filtered[i+1]=0;
                    i++;
                }
                const merged = filtered.filter(v=>v!==0);
                while(merged.length<size) merged.push(0);
                return reverse ? merged.reverse() : merged;
            }

            function hasMoves(){
                for(let r=0;r<size;r++){
                    for(let c=0;c<size;c++){
                        if(grid[r][c]===0) return true;
                        if(c<size-1 && grid[r][c]!==0 && grid[r][c+1]!==0 && grid[r][c]!==1000 && grid[r][c+1]!==1000) return true;
                        if(r<size-1 && grid[r][c]!==0 && grid[r+1][c]!==0 && grid[r][c]!==1000 && grid[r+1][c]!==1000) return true;
                    }
                }
                return false;
            }

            function checkState(){
                for(let r=0;r<size;r++) for(let c=0;c<size;c++) if(grid[r][c]===999) { endGame(true); return; }
                if(!hasMoves()) endGame(false);
            }

            function endGame(win){
                msgText.textContent = win ? 'You win!' : 'Game over!';
                msg.classList.add('show');
                if(!win){
                    setTimeout(()=>{ msg.classList.remove('show'); reset(); }, 800);
                }
            }

            function reset(){
                msg.classList.remove('show');
                grid = emptyGrid();
                score = 0;
                spawn(); spawn();
                draw();
            }

            document.addEventListener('keydown', e=>{
                const keyMap = {ArrowLeft:'left', ArrowRight:'right', ArrowUp:'up', ArrowDown:'down'};
                const dir = keyMap[e.key];
                if(dir){ e.preventDefault(); move(dir); }
            });
            retryBtn.addEventListener('click', reset);
            document.getElementById('reset-button').addEventListener('click', reset);

            reset();
        </script>

